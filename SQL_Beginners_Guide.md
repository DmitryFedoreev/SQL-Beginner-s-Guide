### SQL для тестировщика

Этот гайд предназначен для тестировщиков, которые хотят освоить базовые SQL-запросы и научиться работать с базами данных. В рамках этого руководства мы разберём основные команды SQL.

### Объяснение базовых терминов

**Таблица:** Структура, содержащая данные в виде строк и столбцов. Каждая таблица имеет уникальное имя.

**Строка:** Запись в таблице, представляющая собой один элемент данных.

**Столбец:** Атрибут таблицы, содержащий определённый тип данных. Например, в таблице "Items" столбец "item_name" содержит названия товаров.

**Первичный ключ:** Уникальный идентификатор для каждой строки в таблице. Например, item_id в таблице "Items".

**Внешний ключ:** Поле, которое связывает таблицы между собой. Например, shop_id в таблице "Items", ссылающийся на shop_id в таблице "Shops".


### Таблицы

**Мы будем использовать три связанные таблицы:**

* Cities (города) – список городов в мире.

* Shops (лавки) – торговые точки, расположенные в разных городах.

* Items (товары) – предметы, доступные для покупки в лавках.

Теперь у нас есть данные для работы с SQL-запросами!


## Cities (Города)
| city_id | city_name       | country         |
|---------|------------------|-----------------|
| 1       | Хоббитон        | Шир             |
| 2       | Гондор          | Гондор          |
| 3       | Ривенделл       | Эльфийские земли|
| 4       | Минас Тирит     | Гондор          |
| 5       | Изенгард        | Рохан           |

## Shops (Лавки)
| shop_id | shop_name           | city_id |
|---------|----------------------|---------|
| 1       | Лавка Хоббитов      | 1       |
| 2       | Кузня Арагорна      | 2       |
| 3       | Эльфийский Мастер    | 3       |
| 4       | Магазин Минас Тирит | 4       |
| 5       | Лавка Рохана        | 5       |

## Items (Товары)
| item_id | item_name             | price  | shop_id |
|---------|------------------------|--------|---------|
| 1       | Зелье Исцеления        | 50.00  | 1       |
| 2       | Пирожки Хоббитов      | 5.00   | 1       |
| 3       | Меч Андурила          | 300.00 | 2       |
| 4       | Щит Гондора           | 150.00 | 2       |
| 5       | Лук Эльфийских Воинов  | 100.00 | 3       |
| 6       | Эльфийский Артефакт   | 250.00 | 3       |
| 7       | Меч Минас Тирита      | 200.00 | 4       |
| 8       | Оружие Рохана         | 120.00 | 5       |
| 9       | Зелье Удачи           | 80.00  | 5       |


## Шаблон запроса

```
SELECT { какой столбец вывести }
FROM { из какой таблицы вывести }
JOIN { какую таблицу добавляем }
ON { название столбца из одной таблицы } = { название столбца из другой таблицы }
WHERE { какой столбик известен из тела запроса } = { его значение }
ORDER BY { по какому столбцу сортируем };
```

## # Первый запрос

Давайте выведем название и цену товара, которые есть в таблице **Items**. Для этого возьмем поля ```item_name``` и ```price```:

```
SELECT item_name, price
FROM Items;
```

**Получаем вот такой вывод:**

| item_name               | price  |
|-------------------------|--------|
| Зелье Исцеления         | 50.00  |
| Пирожки Хоббитов       | 5.00   |
| Меч Андурила           | 300.00 |
| Щит Гондора            | 150.00 |
| Лук Эльфийских Воинов   | 100.00 |
| Эльфийский Артефакт    | 250.00 |
| Меч Минас Тирита       | 200.00 |
| Оружие Рохана          | 120.00 |
| Зелье Удачи            | 80.00  |

## # Второй запрос
Давайте выведем товары, у которых цена меньше 100. Для этого мы используем условие ```WHERE```:

```
SELECT item_name, price
FROM Items
WHERE price < 100;
```

**Получаем вот такой вывод:**

| item_name               | price  |
|-------------------------|--------|
| Пирожки Хоббитов       | 5.00   |
| Зелье Исцеления         | 50.00  |
| Зелье Удачи            | 80.00  |


## # Третий запрос
Теперь отсортируем результаты по цене:

```
SELECT item_name, price
FROM Items
ORDER BY price;
```
**Результат:**

| item_name               | price  |
|-------------------------|--------|
| Пирожки Хоббитов       | 5.00   |
| Зелье Исцеления         | 50.00  |
| Зелье Удачи            | 80.00  |
| Лук Эльфийских Воинов   | 100.00 |
| Оружие Рохана          | 120.00 |
| Щит Гондора            | 150.00 |
| Меч Минас Тирита       | 200.00 |
| Эльфийский Артефакт    | 250.00 |
| Меч Андурила           | 300.00 |

## # Четвертый запрос
Давайте попробуем соединить две таблицы. Выведем название товара, его цену и название магазина, в котором он доступен:

```
SELECT Items.item_name, Items.price, Shops.shop_name
FROM Items
JOIN Shops 
ON Items.shop_id = Shops.shop_id;
```
И сразу добавим сюда же сортировку по цене:

```
SELECT Items.item_name, Items.price, Shops.shop_name
FROM Items
JOIN Shops
ON Items.shop_id = Shops.shop_id
ORDER BY Items.price;
```

| item_name               | price  | shop_name            |
|-------------------------|--------|----------------------|
| Пирожки Хоббитов       | 5.00   | Лавка Хоббитов      |
| Зелье Исцеления         | 50.00  | Лавка Хоббитов      |
| Зелье Удачи            | 80.00  | Лавка Рохана        |
| Лук Эльфийских Воинов   | 100.00 | Эльфийский Мастер    |
| Оружие Рохана          | 120.00 | Лавка Рохана        |
| Щит Гондора            | 150.00 | Кузня Арагорна      |
| Меч Минас Тирита       | 200.00 | Магазин Минас Тирит |
| Эльфийский Артефакт    | 250.00 | Эльфийский Мастер    |
| Меч Андурила           | 300.00 | Кузня Арагорна      |

## # Пятый запрос
Давайте поменяем названия для наших столбцов. Мы сделаем так, чтобы ```item_name``` отображалось как "Название товара", ```price``` —  "Цена", ```shop_name``` —  "Название магазина".

Для этого мы используем оператор ```AS```, который позволяет задать псевдонимы для столбцов в результате запроса. Вот как это будет выглядеть:

```
SELECT Items.item_name AS "Название товара", 
       Items.price AS "Цена", 
       Shops.shop_name AS "Название магазина"
FROM Items
JOIN Shops ON Items.shop_id = Shops.shop_id
ORDER BY Items.price;
```
**Результат:**

| Название товара               | Цена   | Название магазина         |
|-------------------------------|--------|---------------------------|
| Пирожки Хоббитов             | 5.00   | Лавка Хоббитов           |
| Зелье Исцеления               | 50.00  | Лавка Хоббитов           |
| Зелье Удачи                  | 80.00  | Лавка Рохана             |
| Лук Эльфийских Воинов         | 100.00 | Эльфийский Мастер         |
| Оружие Рохана                | 120.00 | Лавка Рохана             |
| Щит Гондора                  | 150.00 | Кузня Арагорна           |
| Меч Минас Тирита             | 200.00 | Магазин Минас Тирит      |
| Эльфийский Артефакт          | 250.00 | Эльфийский Мастер         |
| Меч Андурила                 | 300.00 | Кузня Арагорна           |

---

Мы рассмотрели основные запросы SQL, включая создание простых запросов, соединение таблиц, использование группировки и фильтрации данных.
Теперь сами попробуйте решить несколько заданий, чтобы закрепить полученные навыки и углубить понимание SQL.


### # Вывести названия городов из таблицы Cities.
<details> <summary>Показать результат</summary>

```
SELECT city_name 
FROM Cities;
```

</details>

### # Вывести названия и цены товаров, которые стоят больше 200.
<details> <summary>Показать результат</summary>

```
SELECT item_name, price 
FROM Items 
WHERE price > 200;
```

</details>

### # Вывести уникальные названия товаров из таблицы Items.
<details> <summary>Показать результат</summary>

```
SELECT DISTINCT item_name 
FROM Items;
```

</details>

### # Посчитать общее количество магазинов в таблице Shops.
<details> <summary>Показать результат</summary>

```
SELECT COUNT(*) AS total_shops 
FROM Shops;
```

</details>

### # Вывести названия товаров и магазинов, у которых цена больше 100 и меньше 300.
<details> <summary>Показать результат</summary>

```
SELECT Items.item_name, Shops.shop_name 
FROM Items 
JOIN Shops ON Items.shop_id = Shops.shop_id 
WHERE price > 100 AND price < 300;
```

</details>

### # Вывести товары, у которых цена равна максимальной цене в таблице Items.
<details> <summary>Показать результат</summary>

```
SELECT item_name 
FROM Items 
WHERE price = (SELECT MAX(price) FROM Items);
```

</details>

### # Вывести список городов, в которых есть магазины, и их количество.
<details> <summary>Показать результат</summary>

```
SELECT Cities.city_name, COUNT(Shops.shop_id) AS shop_count 
FROM Cities 
JOIN Shops ON Cities.city_id = Shops.city_id 
GROUP BY Cities.city_name;
```

</details>

### # Вывести товары, которые продаются в нескольких лавках (с количеством).
<details> <summary>Показать результат</summary>

```
SELECT Items.item_name, COUNT(Shops.shop_id) AS shop_count 
FROM Items 
JOIN Shops ON Items.shop_id = Shops.shop_id 
GROUP BY Items.item_name 
HAVING COUNT(Shops.shop_id) > 1;
```

</details>

### # Вывести товары, которые не доступны в лавке "Эльфийский Мастер".
<details> <summary>Показать результат</summary>

```
SELECT item_name 
FROM Items 
WHERE shop_id != (SELECT shop_id FROM Shops WHERE shop_name = 'Эльфийский Мастер');
```

</details>
